OD Bath
================
Blaise Kelly
29/05/2022

## Introduction

Data from the 2011 UK census data is queried using the Propensity to
Cycle Tool (pct) R package. Origin Destination (OD) matrices are created
and ‘jittered’ using the ODjitter R package.

## area of interest

    ## Creating centroids representing desire line start and end points.

    ## PhantomJS not found. You can install it with webshot::install_phantomjs(). If it is installed, please make sure the phantomjs executable can be found via the PATH variable.

<div id="htmlwidget-7858e1a8c021adf509b0" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-7858e1a8c021adf509b0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[51.3727621758558,-2.42667996879891],11,[]],"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-2.5494499206,-2.303910017,-2.303910017,-2.5494499206,-2.5494499206],"lat":[51.42509,51.42509,51.320346,51.320346,51.42509]}]]],null,"area of interest",{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":0.5,"fill":true,"fillColor":"grey","fillOpacity":0.5,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"color":"white","weight":2,"bringToFront":false}]},{"method":"addLayersControl","args":[[],"area of interest",{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[51.320346,51.42509],"lng":[-2.5494499206,-2.303910017]}},"evals":[],"jsHooks":[]}</script>

Import the census zones from the pct data from pct package and intersect
with area of interest

<div id="htmlwidget-336482ca80658c089762" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-336482ca80658c089762">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[51.3727621758558,-2.42667996879891],11,[]],"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-2.34640480042814,-2.34959766070121,-2.35131446531014,-2.35145938591343,-2.34897665251022,-2.34755328559091,-2.34089369937508,-2.34454972118532,-2.34797209138928,-2.34640480042814],"lat":[51.3772657036845,51.3795436235579,51.3809464328577,51.3867258581845,51.3876216541932,51.3891257185921,51.3837855366209,51.3803603144883,51.3821367843053,51.3772657036845]}]],[[{"lng":[-2.37669126450364,-2.37833637088955,-2.38762387456592,-2.38942266100829,-2.38639754682491,-2.38062269800466,-2.38222411120838,-2.37662810183607,-2.37669126450364],"lat":[51.3889581719777,51.3892621875266,51.3924194417414,51.3947499891262,51.3982140949371,51.4006676670809,51.3949854330289,51.3956572928227,51.3889581719777]}]],[[{"lng":[-2.31040783426164,-2.31021461541271,-2.32298300989354,-2.33742924359704,-2.34427979679817,-2.32404751330472,-2.30852821256,-2.2979433211134,-2.29433944738511,-2.30092698074335,-2.28843889190731,-2.28909095183621,-2.31330520477673,-2.31357369731564,-2.33252112359829,-2.34160443327049,-2.34522439097178,-2.33579290357338,-2.32283317343945,-2.32430500158877,-2.33658479590139,-2.34913423396057,-2.34857381204513,-2.34182061723529,-2.34127084786659,-2.35293058471471,-2.36756112712406,-2.37201469338824,-2.3802810180309,-2.3824772634542,-2.37410447625415,-2.37230129813241,-2.36404689156878,-2.35662135058242,-2.34700163914284,-2.33796068069654,-2.33182956553742,-2.31830317940689,-2.31040783426164],"lat":[51.3618860565622,51.3575342471248,51.3566566215953,51.3514294412704,51.3454011406217,51.3477599387107,51.3397505311256,51.3431923902275,51.337629016067,51.3332225750265,51.3297707974245,51.3252720185565,51.3171529584987,51.3170715792886,51.3084434008011,51.309694897562,51.3136699391969,51.3194011808575,51.3191978325238,51.3229473942844,51.3221045690402,51.3293867606835,51.3334302537294,51.3346234804548,51.3441169506176,51.340240190607,51.3415016649124,51.3479104469074,51.3480538918912,51.3515975544749,51.3507928424906,51.3549186793757,51.3552971129561,51.3555796989308,51.354856448469,51.3564974734938,51.3636086731364,51.3637432658705,51.3618860565622]}]],[[{"lng":[-2.46487308217597,-2.46554882506865,-2.47485948606863,-2.47781124307213,-2.48436887538914,-2.48870359232234,-2.48256929157247,-2.46487308217597],"lat":[51.4101185045766,51.4100235967054,51.4071161312822,51.4024686723546,51.4029422789771,51.407820963234,51.4150779614145,51.4101185045766]}]],[[{"lng":[-2.51046219485018,-2.50798532592169,-2.4993638896568,-2.49290648184295,-2.48843461582832,-2.49289596947072,-2.49352479040112,-2.49654923471644,-2.50063157560257,-2.51024546500016,-2.5129608300719,-2.50822544914225,-2.51245782520026,-2.50820420721501,-2.50834556117977,-2.51150338945859,-2.51837536836444,-2.52229742438565,-2.5172901722492,-2.52726001192712,-2.53450157886369,-2.53401678745134,-2.53394511502478,-2.53376475478248,-2.5292542003466,-2.5313127993692,-2.5232107316042,-2.52629030601189,-2.52395071886915,-2.51371534848562,-2.51046219485018],"lat":[51.4287822002986,51.4246413937411,51.4282709597833,51.4293049859705,51.426479455312,51.4183450005738,51.4179731602866,51.4232741361411,51.4194786215928,51.4236649653055,51.4208476604293,51.4169769471131,51.4122211012082,51.4090009433599,51.4090074567345,51.4098992728239,51.4048741414943,51.405772090437,51.4159370739991,51.4118436857957,51.4138484097003,51.4181102129594,51.4181490280127,51.4182146703664,51.4212788045426,51.4233079784072,51.4261372327564,51.4347772410731,51.4325161577911,51.4294051499658,51.4287822002986]}]],[[{"lng":[-2.4027966909121,-2.40424207553864,-2.40039807565782,-2.40024626974299,-2.4042019597757,-2.40729086529151,-2.41415201643252,-2.41224218149374,-2.4027966909121],"lat":[51.3785382948481,51.3768280149649,51.3770708846129,51.3752247679046,51.3727573266403,51.3734329277027,51.376403994912,51.3786032470829,51.3785382948481]}]],[[{"lng":[-2.34575184240744,-2.35835981732233,-2.34402077397053,-2.34140150354204,-2.34575184240744],"lat":[51.3969102469093,51.4031688534536,51.4018973865378,51.4006104045622,51.3969102469093]}]],[[{"lng":[-2.38062269800466,-2.38639754682491,-2.3951312215043,-2.39306403267471,-2.38722789485941,-2.38062269800466],"lat":[51.4006676670809,51.3982140949371,51.3981332853525,51.4052366940601,51.4066332472011,51.4006676670809]}]],[[{"lng":[-2.39063773702248,-2.39054055229492,-2.39169478221754,-2.40039807565782,-2.40424207553864,-2.4027966909121,-2.39899826799588,-2.40317083043368,-2.4018234049221,-2.39873456617531,-2.39063773702248],"lat":[51.3813899443712,51.3804185762931,51.378964774292,51.3770708846129,51.3768280149649,51.3785382948481,51.3808275840781,51.3818329563858,51.3843346736951,51.3827992113861,51.3813899443712]}]],[[{"lng":[-2.55073038743594,-2.54642196214059,-2.52865321083094,-2.52611459288384,-2.53259597140507,-2.54705928487775,-2.54296734768435,-2.54953335867406,-2.54956304452839,-2.55344743694504,-2.55890110942103,-2.56361854932119,-2.55735109674056,-2.55073038743594],"lat":[51.392542814916,51.3961110849712,51.3865415810526,51.3662996634636,51.3566374171532,51.3561347703337,51.3591112835473,51.3635137080004,51.3635558514821,51.3727083263827,51.3731653770082,51.3780478875366,51.3806549229886,51.392542814916]}]],[[{"lng":[-2.40500633026246,-2.39843457738937,-2.39219447590446,-2.3933926231633,-2.39873456617531,-2.4018234049221,-2.40500633026246],"lat":[51.3870189157499,51.3885251283458,51.3864287376909,51.3826006075513,51.3827992113861,51.3843346736951,51.3870189157499]}]],[[{"lng":[-2.3889004887688,-2.38905399106062,-2.3914108123296,-2.39609515824084,-2.40024626974299,-2.40039807565782,-2.39169478221754,-2.3889004887688],"lat":[51.3773079308762,51.3767750904621,51.3755291801434,51.3734180218243,51.3752247679046,51.3770708846129,51.378964774292,51.3773079308762]}]],[[{"lng":[-2.54055038986811,-2.53646473865606,-2.54340658286662,-2.54387736658124,-2.54962406883262,-2.54969013172699,-2.54481501751687,-2.54674912838822,-2.54055038986811],"lat":[51.412819954255,51.4122274849115,51.4074329798158,51.4076204945577,51.4092637066695,51.411739139888,51.4117735514353,51.4141400198175,51.412819954255]}]],[[{"lng":[-2.54962406883262,-2.55632947592297,-2.55324292631524,-2.55043063379618,-2.54674912838822,-2.54481501751687,-2.54969013172699,-2.54962406883262],"lat":[51.4092637066695,51.40960301559,51.413912868238,51.413380136189,51.4141400198175,51.4117735514353,51.411739139888,51.4092637066695]}]],[[{"lng":[-2.39609515824084,-2.40055081668002,-2.4042019597757,-2.40024626974299,-2.39609515824084],"lat":[51.3734180218243,51.3705456856614,51.3727573266403,51.3752247679046,51.3734180218243]}]],[[{"lng":[-2.36110336421737,-2.35849239970673,-2.36054024266229,-2.37627426930065,-2.37619586559175,-2.37182003601916,-2.37013196629814,-2.36998515510119,-2.36646745955379,-2.36755808240733,-2.36110336421737],"lat":[51.3718241647733,51.3661637221746,51.3647242362565,51.3658737358014,51.3662528042949,51.3723262212844,51.3743783687667,51.3743800862947,51.3737047274514,51.3692587033908,51.3718241647733]}]],[[{"lng":[-2.36275762695524,-2.35996710960378,-2.36143180340001,-2.36557791603565,-2.36924137335763,-2.36833563301706,-2.36275762695524],"lat":[51.3917559155881,51.392348169724,51.3873433420048,51.3880772422156,51.3901681039012,51.3930413401862,51.3917559155881]}]],[[{"lng":[-2.38021923272351,-2.38291158545088,-2.38212872690514,-2.38012508118601,-2.37437786346905,-2.37013196629814,-2.37182003601916,-2.38021923272351],"lat":[51.3722939940797,51.3733097591534,51.3740975212482,51.3754159868319,51.3760404634427,51.3743783687667,51.3723262212844,51.3722939940797]}]],[[{"lng":[-2.38021923272351,-2.37182003601916,-2.37619586559175,-2.3824725582488,-2.38021923272351],"lat":[51.3722939940797,51.3723262212844,51.3662528042949,51.3680901655538,51.3722939940797]}]],[[{"lng":[-2.316672613364,-2.31830317940689,-2.33182956553742,-2.33796068069654,-2.34700163914284,-2.3459197848806,-2.35196759672139,-2.34653617799108,-2.34306686937504,-2.33780562437076,-2.33657482895936,-2.33256610332355,-2.32629222696664,-2.32099372547966,-2.316672613364],"lat":[51.3681079052938,51.3637432658705,51.3636086731364,51.3564974734938,51.354856448469,51.3627599403919,51.3657196553287,51.3660747956315,51.3625467341255,51.3631140802837,51.3662908568406,51.368307474303,51.3663514198315,51.3709886835128,51.3681079052938]}]],[[{"lng":[-2.34700163914284,-2.35662135058242,-2.3528639680878,-2.35404142047054,-2.35196759672139,-2.3459197848806,-2.34700163914284],"lat":[51.354856448469,51.3555796989308,51.3579209931936,51.3645445273739,51.3657196553287,51.3627599403919,51.354856448469]}]],[[{"lng":[-2.30751880112869,-2.3098839344336,-2.31008103223901,-2.31040783426164,-2.31830317940689,-2.316672613364,-2.31752764743259,-2.32336803602334,-2.33819028339899,-2.33462496066414,-2.3423686274979,-2.34258523373107,-2.31912527986304,-2.32283644775867,-2.31265134367829,-2.31236788350926,-2.29964819208783,-2.29977451707864,-2.30751880112869],"lat":[51.3649968313077,51.3627373141861,51.3623823827587,51.3618860565622,51.3637432658705,51.3681079052938,51.3768356333176,51.3823082657376,51.3806415626587,51.3874612370241,51.3921388425548,51.3921282734472,51.3993780343845,51.3940396793167,51.3918449533444,51.386929305159,51.3785894034334,51.3719451157584,51.3649968313077]}]],[[{"lng":[-2.28181251390009,-2.29157215836126,-2.30053795013691,-2.31006142704243,-2.31235905058284,-2.30587067965245,-2.31438565652748,-2.31179041568252,-2.29817350626315,-2.29777386811925,-2.29771911690433,-2.29534476791183,-2.28474222188615,-2.27854158250835,-2.2908613729564,-2.28181251390009],"lat":[51.3972280963446,51.3954969614134,51.3998744720724,51.3992587589517,51.4031145689487,51.4084612106741,51.4070540855547,51.4121051408644,51.4153106013692,51.4189799739471,51.4191138434956,51.4262523655427,51.4234247378947,51.4158819010215,51.4057121307101,51.3972280963446]}]],[[{"lng":[-2.48436887538914,-2.47781124307213,-2.47884730961223,-2.48312436642127,-2.47932044063196,-2.49825380646914,-2.49517570700171,-2.49312805540385,-2.48436887538914],"lat":[51.4029422789771,51.4024686723546,51.3966572528089,51.3968626387416,51.3902404936872,51.3918908433158,51.4015072580483,51.4043116706766,51.4029422789771]}]],[[{"lng":[-2.46093348331866,-2.46487308217597,-2.48256929157247,-2.48870359232234,-2.49021360806859,-2.49482240328449,-2.49480275178353,-2.49552971422827,-2.49352479040112,-2.49289596947072,-2.49285128602039,-2.48911959002905,-2.4888488120401,-2.48326882511127,-2.48307306885257,-2.47635967825033,-2.47612236950158,-2.46093348331866],"lat":[51.4166621178722,51.4101185045766,51.4150779614145,51.407820963234,51.4102772822729,51.4095943389508,51.4096313820016,51.4140258503213,51.4179731602866,51.4183450005738,51.4182708646939,51.4182365920072,51.4184427358076,51.4213891521979,51.4214260612387,51.4184969141148,51.4183895861908,51.4166621178722]}]],[[{"lng":[-2.35001917312889,-2.35219427320218,-2.35271413606714,-2.35702962715452,-2.35131374614642,-2.35001917312889],"lat":[51.3959643272717,51.3922056139105,51.3918159236214,51.394852617611,51.3982941405996,51.3959643272717]}]],[[{"lng":[-2.36313161810383,-2.36329269949425,-2.3679044259759,-2.36965544502893,-2.36521820247275,-2.36693883476902,-2.36313161810383],"lat":[51.3836365194997,51.3782654210606,51.37962878015,51.3813650642103,51.3825058366723,51.3858899012321,51.3836365194997]}]],[[{"lng":[-2.49480275178353,-2.49482240328449,-2.49473236497247,-2.49476033989231,-2.49594309916773,-2.50277974988395,-2.50834556117977,-2.50820420721501,-2.50462080899407,-2.50411832541516,-2.49906119566138,-2.49480275178353],"lat":[51.4096313820016,51.4095943389508,51.4053756851185,51.4052278857805,51.4013635627723,51.399701128148,51.4090074567345,51.4090009433599,51.4097509235084,51.4098655927635,51.4070986772047,51.4096313820016]}]],[[{"lng":[-2.38717997979726,-2.38212872690514,-2.38291158545088,-2.38771035187389,-2.38839797639181,-2.38717997979726],"lat":[51.3751018665448,51.3740975212482,51.3733097591534,51.369110616813,51.3700989486271,51.3751018665448]}]],[[{"lng":[-2.38021923272351,-2.3824725582488,-2.38740359390829,-2.38771035187389,-2.38291158545088,-2.38021923272351],"lat":[51.3722939940797,51.3680901655538,51.3659842595821,51.369110616813,51.3733097591534,51.3722939940797]}]],[[{"lng":[-2.29461574142493,-2.29534476791183,-2.29771911690433,-2.29777386811925,-2.29817350626315,-2.31179041568252,-2.32150369367072,-2.32623467649984,-2.32646675243988,-2.33930191311322,-2.33811904115167,-2.34402077397053,-2.35835981732233,-2.36497732307691,-2.36706573860452,-2.37292720597905,-2.36748561724236,-2.37092803858727,-2.37852848046989,-2.38722789485941,-2.39306403267471,-2.40132889398481,-2.40381921736649,-2.39809347810494,-2.39789552429601,-2.40019568759322,-2.40788961046817,-2.41163002867586,-2.43136692158882,-2.44285990108987,-2.45092340070467,-2.43833642201412,-2.44591007197325,-2.44585171474178,-2.44422827772053,-2.44410336857942,-2.44336140670233,-2.44283962928905,-2.44400663227765,-2.42087372621299,-2.42051508657673,-2.41033351492894,-2.40309928592497,-2.37725377692647,-2.36721918462661,-2.35766994221204,-2.34328971641227,-2.32502125542503,-2.3138442661772,-2.31261575485688,-2.29461574142493],"lat":[51.4288015723113,51.4262523655427,51.4191138434956,51.4189799739471,51.4153106013692,51.4121051408644,51.4137678103999,51.4115493382214,51.4065191161279,51.4063467468122,51.4036704794083,51.4018973865378,51.4031688534536,51.4010512155735,51.4019549087996,51.4045260913854,51.4082487655816,51.4106180760943,51.41113060063,51.4066332472011,51.4052366940601,51.4075918940402,51.4058507397228,51.3982208127375,51.3961894562132,51.3937609933066,51.3957234714967,51.39273677461,51.3906229118944,51.3955380693746,51.4031092682944,51.4132015562981,51.4184790298614,51.4185817784137,51.4185216952668,51.4184697131868,51.4183712300975,51.4186508030149,51.4225693474493,51.4243326606439,51.4244790974041,51.4263284406134,51.4315948801439,51.4328308327241,51.437053827015,51.4358380196411,51.4395335305134,51.4369834463781,51.4289038106821,51.422446129671,51.4288015723113]}]],[[{"lng":[-2.29157215836126,-2.29678785049111,-2.2974948795422,-2.29028854554242,-2.29650638237318,-2.29880607893625,-2.2989428883083,-2.30221919399807,-2.3023773283399,-2.30751880112869,-2.29977451707864,-2.29964819208783,-2.31236788350926,-2.31265134367829,-2.32283644775867,-2.31912527986304,-2.34258523373107,-2.33968540836512,-2.32484804063369,-2.31438565652748,-2.30587067965245,-2.31235905058284,-2.31006142704243,-2.30053795013691,-2.29157215836126],"lat":[51.3954969614134,51.3948868283622,51.3849187011994,51.3726209883417,51.3643014844792,51.3627856734958,51.3626991499757,51.3626891739718,51.3627307987482,51.3649968313077,51.3719451157584,51.3785894034334,51.386929305159,51.3918449533444,51.3940396793167,51.3993780343845,51.3921282734472,51.3938902345442,51.4018208349968,51.4070540855547,51.4084612106741,51.4031145689487,51.3992587589517,51.3998744720724,51.3954969614134]}]],[[{"lng":[-2.35581865622074,-2.36313161810383,-2.36693883476902,-2.36557791603565,-2.36143180340001,-2.35880788024201,-2.35581865622074],"lat":[51.3893795374531,51.3836365194997,51.3858899012321,51.3880772422156,51.3873433420048,51.3893768080432,51.3893795374531]}]],[[{"lng":[-2.53858584461343,-2.54164441879725,-2.56243228106971,-2.55449461479179,-2.55663931492274,-2.54754021131713,-2.5486738124149,-2.53839064640779,-2.53858584461343],"lat":[51.3248869520937,51.3219668512881,51.3323089542683,51.3397281791674,51.3440963064593,51.34318220594,51.3371519872994,51.3340609232871,51.3248869520937]}]],[[{"lng":[-2.35662135058242,-2.36404689156878,-2.36221338170354,-2.35658581240085,-2.35626548428576,-2.35404142047054,-2.3528639680878,-2.35662135058242],"lat":[51.3555796989308,51.3552971129561,51.3610904418517,51.3615683783539,51.3641380986374,51.3645445273739,51.3579209931936,51.3555796989308]}]],[[{"lng":[-2.35626548428576,-2.35658581240085,-2.36221338170354,-2.36054024266229,-2.35849239970673,-2.35626548428576],"lat":[51.3641380986374,51.3615683783539,51.3610904418517,51.3647242362565,51.3661637221746,51.3641380986374]}]],[[{"lng":[-2.46538464309122,-2.48142773786857,-2.4830551697924,-2.49665202866407,-2.4980905838997,-2.50407016997052,-2.51470087479957,-2.51579536869014,-2.52279032215916,-2.50859944908497,-2.52428936533357,-2.50961264994414,-2.50575532560131,-2.49916989415106,-2.49523748815856,-2.4971722272933,-2.48437115703007,-2.4758818764787,-2.46720519479606,-2.44005657991469,-2.45246417808411,-2.44286806996003,-2.46789235615992,-2.46538464309122],"lat":[51.3367790803065,51.3371473776635,51.3370019140287,51.3351629452507,51.3270640666626,51.3267664605977,51.3259592085187,51.3304170949572,51.3446250582054,51.3509161536638,51.361535802701,51.3626741188896,51.3592127345955,51.3590179390449,51.3603635835759,51.3628857912619,51.3655622939626,51.3753306734657,51.3727544339879,51.3779362985443,51.3670935931307,51.3637753783837,51.3558415935649,51.3367790803065]}]],[[{"lng":[-2.51837536836444,-2.51651602875018,-2.50277974988395,-2.49594309916773,-2.49517570700171,-2.49825380646914,-2.47932044063196,-2.47085133568229,-2.46908886323509,-2.4585996785727,-2.45108232154764,-2.44655661341407,-2.44285990108987,-2.43136692158882,-2.44005657991469,-2.46720519479606,-2.4758818764787,-2.48437115703007,-2.4971722272933,-2.49523748815856,-2.49916989415106,-2.50575532560131,-2.50961264994414,-2.52428936533357,-2.52611459288384,-2.52865321083094,-2.54642196214059,-2.54503255363091,-2.52726001192712,-2.5172901722492,-2.52229742438565,-2.51837536836444],"lat":[51.4048741414943,51.3988290189916,51.399701128148,51.4013635627723,51.4015072580483,51.3918908433158,51.3902404936872,51.3877535632844,51.3913997042934,51.3918556364637,51.3956164296244,51.3926906212358,51.3955380693746,51.3906229118944,51.3779362985443,51.3727544339879,51.3753306734657,51.3655622939626,51.3628857912619,51.3603635835759,51.3590179390449,51.3592127345955,51.3626741188896,51.361535802701,51.3662996634636,51.3865415810526,51.3961110849712,51.4002619384897,51.4118436857957,51.4159370739991,51.405772090437,51.4048741414943]}]],[[{"lng":[-2.34928198798238,-2.33968540836512,-2.34258523373107,-2.3423686274979,-2.34755328559091,-2.34897665251022,-2.35219427320218,-2.35001917312889,-2.34928198798238],"lat":[51.3955388022072,51.3938902345442,51.3921282734472,51.3921388425548,51.3891257185921,51.3876216541932,51.3922056139105,51.3959643272717,51.3955388022072]}]],[[{"lng":[-2.4993638896568,-2.50798532592169,-2.51046219485018,-2.51343630180006,-2.51334571028848,-2.51006724632359,-2.49597292174044,-2.48900472383459,-2.49887340929414,-2.4993638896568],"lat":[51.4282709597833,51.4246413937411,51.4287822002986,51.4296315999431,51.429874636563,51.4386680149583,51.4385464863268,51.4341324828491,51.4338795438027,51.4282709597833]}]],[[{"lng":[-2.50462080899407,-2.5066274868937,-2.5012723576398,-2.50822544914225,-2.5129608300719,-2.51024546500016,-2.50063157560257,-2.49654923471644,-2.49352479040112,-2.49552971422827,-2.50542587421315,-2.50411832541516,-2.50462080899407],"lat":[51.4097509235084,51.4138896907503,51.4164499952478,51.4169769471131,51.4208476604293,51.4236649653055,51.4194786215928,51.4232741361411,51.4179731602866,51.4140258503213,51.4127391023082,51.4098655927635,51.4097509235084]}]],[[{"lng":[-2.36329269949425,-2.36045803513299,-2.3570500461289,-2.36298649976713,-2.36843563205427,-2.3679044259759,-2.36329269949425],"lat":[51.3782654210606,51.3776136001735,51.3770522942313,51.3752517174478,51.3760837423363,51.37962878015,51.3782654210606]}]],[[{"lng":[-2.49480275178353,-2.49906119566138,-2.50411832541516,-2.50542587421315,-2.49552971422827,-2.49480275178353],"lat":[51.4096313820016,51.4070986772047,51.4098655927635,51.4127391023082,51.4140258503213,51.4096313820016]}]],[[{"lng":[-2.34640480042814,-2.33394863700627,-2.33657482895936,-2.33780562437076,-2.34306686937504,-2.34653617799108,-2.35196759672139,-2.35404142047054,-2.35626548428576,-2.35849239970673,-2.36110336421737,-2.3611557897012,-2.35075078746787,-2.34959766070121,-2.34640480042814],"lat":[51.3772657036845,51.3748900071624,51.3662908568406,51.3631140802837,51.3625467341255,51.3660747956315,51.3657196553287,51.3645445273739,51.3641380986374,51.3661637221746,51.3718241647733,51.3732852797144,51.3721464387674,51.3795436235579,51.3772657036845]}]],[[{"lng":[-2.37942971954,-2.38012508118601,-2.38212872690514,-2.38717997979726,-2.38905399106062,-2.3889004887688,-2.38422279981908,-2.38463793292213,-2.37942971954],"lat":[51.3777175936838,51.3754159868319,51.3740975212482,51.3751018665448,51.3767750904621,51.3773079308762,51.3768756464627,51.3800096382291,51.3777175936838]}]],[[{"lng":[-2.45092340070467,-2.44285990108987,-2.44655661341407,-2.45108232154764,-2.4585996785727,-2.46908886323509,-2.46398734572784,-2.45840981854759,-2.45572438778508,-2.45092340070467],"lat":[51.4031092682944,51.3955380693746,51.3926906212358,51.3956164296244,51.3918556364637,51.3913997042934,51.4000142039313,51.3990075086518,51.4039403435375,51.4031092682944]}]],[[{"lng":[-2.44591007197325,-2.43833642201412,-2.45092340070467,-2.45572438778508,-2.45840981854759,-2.46398734572784,-2.45933697965711,-2.46716515447587,-2.46554882506865,-2.46487308217597,-2.46093348331866,-2.45595041709973,-2.45592890376089,-2.45500139521353,-2.45479262272083,-2.44591007197325],"lat":[51.4184790298614,51.4132015562981,51.4031092682944,51.4039403435375,51.3990075086518,51.4000142039313,51.4013098023391,51.405527043823,51.4100235967054,51.4101185045766,51.4166621178722,51.4184745884523,51.4184792202247,51.418483673373,51.4184566577703,51.4184790298614]}]],[[{"lng":[-2.4055367372933,-2.41224218149374,-2.41415201643252,-2.40729086529151,-2.40872612657479,-2.39919098892054,-2.40217800907956,-2.39701046421074,-2.39356093627671,-2.38926216733299,-2.3835956228016,-2.38229604199306,-2.3824772634542,-2.3802810180309,-2.37201469338824,-2.36756112712406,-2.37444989085797,-2.38123449069083,-2.38974150960009,-2.39284241680848,-2.40864191277335,-2.41566531013987,-2.4250384322742,-2.43623122069495,-2.44458079911872,-2.44250735729211,-2.44089613479891,-2.42980397033706,-2.42377918284977,-2.42926005878986,-2.43253022288284,-2.44694240932519,-2.45353602305988,-2.45858473135996,-2.46467358087938,-2.47121967496637,-2.46162909758515,-2.46518537879981,-2.46538464309122,-2.46789235615992,-2.44286806996003,-2.45246417808411,-2.44005657991469,-2.43136692158882,-2.41163002867586,-2.4055367372933],"lat":[51.3875760155161,51.3786032470829,51.376403994912,51.3734329277027,51.3687513634066,51.3683675659105,51.3658929996875,51.3641815850247,51.3618851031978,51.3639262451259,51.3571517527237,51.3539813616662,51.3515975544749,51.3480538918912,51.3479104469074,51.3415016649124,51.3309926045794,51.3351464612626,51.3353648579246,51.3311975372189,51.3323662832517,51.3250437096852,51.3243918905327,51.3251902093299,51.3216375361385,51.3121444919249,51.3088799281508,51.2986890586828,51.2973702923984,51.2950385408647,51.3011924808661,51.3055805294462,51.3023999059895,51.3049690430389,51.3071715926026,51.3165716066946,51.324897718476,51.329706943912,51.3367790803065,51.3558415935649,51.3637753783837,51.3670935931307,51.3779362985443,51.3906229118944,51.39273677461,51.3875760155161]}]],[[{"lng":[-2.4250384322742,-2.4189736612745,-2.42382811533433,-2.42084044108043,-2.42337791704809,-2.43154776789725,-2.43341735319929,-2.44250735729211,-2.44458079911872,-2.43623122069495,-2.4250384322742],"lat":[51.3243918905327,51.3206918601001,51.3178130209583,51.3166041058601,51.3130106547126,51.3176732542418,51.3141978763159,51.3121444919249,51.3216375361385,51.3251902093299,51.3243918905327]}]],[[{"lng":[-2.36557791603565,-2.36693883476902,-2.36521820247275,-2.36965544502893,-2.3733024799839,-2.37701065540405,-2.37833637088955,-2.37669126450364,-2.36924137335763,-2.36557791603565],"lat":[51.3880772422156,51.3858899012321,51.3825058366723,51.3813650642103,51.3834660181565,51.384424018687,51.3892621875266,51.3889581719777,51.3901681039012,51.3880772422156]}]],[[{"lng":[-2.50462080899407,-2.50820420721501,-2.51245782520026,-2.50822544914225,-2.5012723576398,-2.5066274868937,-2.50462080899407],"lat":[51.4097509235084,51.4090009433599,51.4122211012082,51.4169769471131,51.4164499952478,51.4138896907503,51.4097509235084]}]],[[{"lng":[-2.3951312215043,-2.38639754682491,-2.38942266100829,-2.3911045589307,-2.39789552429601,-2.39809347810494,-2.3951312215043],"lat":[51.3981332853525,51.3982140949371,51.3947499891262,51.3944198451005,51.3961894562132,51.3982208127375,51.3981332853525]}]],[[{"lng":[-2.3888165936924,-2.38845614292048,-2.39063773702248,-2.39873456617531,-2.3933926231633,-2.39219447590446,-2.3888165936924],"lat":[51.3858102915361,51.3816867619939,51.3813899443712,51.3827992113861,51.3826006075513,51.3864287376909,51.3858102915361]}]],[[{"lng":[-2.53858584461343,-2.5297629008731,-2.52850440215095,-2.53406975157679,-2.53766961915003,-2.54057431605985,-2.54863263698019,-2.55724070358521,-2.57535206842235,-2.57811375101536,-2.57119352788181,-2.5730644331322,-2.56243228106971,-2.54164441879725,-2.53858584461343],"lat":[51.3248869520937,51.319809087318,51.3151766888957,51.3154032726639,51.3104600224788,51.3123638010971,51.3093085857904,51.3031389883778,51.3080916599799,51.3186951902332,51.3232584761599,51.3306156016057,51.3323089542683,51.3219668512881,51.3248869520937]}]],[[{"lng":[-2.40309928592497,-2.41033351492894,-2.42051508657673,-2.42087372621299,-2.44400663227765,-2.44283962928905,-2.44336140670233,-2.44410336857942,-2.44422827772053,-2.44585171474178,-2.44591007197325,-2.45479262272083,-2.45500139521353,-2.45592890376089,-2.45595041709973,-2.46093348331866,-2.47612236950158,-2.47635967825033,-2.48307306885257,-2.48326882511127,-2.4888488120401,-2.48911959002905,-2.49285128602039,-2.49289596947072,-2.48843461582832,-2.48319528439576,-2.47647074917707,-2.47999075902759,-2.47320620670088,-2.46697829578761,-2.46323231105207,-2.45739955948568,-2.44353299836548,-2.43084572853661,-2.40740330388232,-2.40259806761002,-2.40309928592497],"lat":[51.4315948801439,51.4263284406134,51.4244790974041,51.4243326606439,51.4225693474493,51.4186508030149,51.4183712300975,51.4184697131868,51.4185216952668,51.4185817784137,51.4184790298614,51.4184566577703,51.418483673373,51.4184792202247,51.4184745884523,51.4166621178722,51.4183895861908,51.4184969141148,51.4214260612387,51.4213891521979,51.4184427358076,51.4182365920072,51.4182708646939,51.4183450005738,51.426479455312,51.4325149021713,51.4303394632808,51.4333798255875,51.4318942403273,51.4366397861557,51.4368479552669,51.4408351285928,51.441577844262,51.4422431508979,51.436619875979,51.4385903193472,51.4315948801439]}]],[[{"lng":[-2.316672613364,-2.32099372547966,-2.32629222696664,-2.33256610332355,-2.33657482895936,-2.33394863700627,-2.34640480042814,-2.34797209138928,-2.34454972118532,-2.34089369937508,-2.34755328559091,-2.3423686274979,-2.33462496066414,-2.33819028339899,-2.32336803602334,-2.31752764743259,-2.316672613364],"lat":[51.3681079052938,51.3709886835128,51.3663514198315,51.368307474303,51.3662908568406,51.3748900071624,51.3772657036845,51.3821367843053,51.3803603144883,51.3837855366209,51.3891257185921,51.3921388425548,51.3874612370241,51.3806415626587,51.3823082657376,51.3768356333176,51.3681079052938]}]],[[{"lng":[-2.35271413606714,-2.3584838775285,-2.35737843127432,-2.35702962715452,-2.35271413606714],"lat":[51.3918159236214,51.3906324745186,51.3946782376194,51.394852617611,51.3918159236214]}]],[[{"lng":[-2.34160443327049,-2.36863770952012,-2.38157491117804,-2.38718062663255,-2.3918910239824,-2.39982640061833,-2.42025958475112,-2.42377918284977,-2.4202674186472,-2.42171724359285,-2.41439140905158,-2.41193756062677,-2.41566531013987,-2.40864191277335,-2.39284241680848,-2.38974150960009,-2.38123449069083,-2.37444989085797,-2.36756112712406,-2.35293058471471,-2.34127084786659,-2.34182061723529,-2.34857381204513,-2.34913423396057,-2.33658479590139,-2.32430500158877,-2.32283317343945,-2.33579290357338,-2.34522439097178,-2.34160443327049],"lat":[51.309694897562,51.3011137627387,51.3000849348783,51.2946434618707,51.2953712285742,51.3048893468299,51.2966213568409,51.2973702923984,51.2990509958726,51.3052782327893,51.311492194708,51.3173047711388,51.3250437096852,51.3323662832517,51.3311975372189,51.3353648579246,51.3351464612626,51.3309926045794,51.3415016649124,51.340240190607,51.3441169506176,51.3346234804548,51.3334302537294,51.3293867606835,51.3221045690402,51.3229473942844,51.3191978325238,51.3194011808575,51.3136699391969,51.309694897562]}]],[[{"lng":[-2.38762387456592,-2.3888165936924,-2.39219447590446,-2.39843457738937,-2.39709050413155,-2.39223713782752,-2.3911045589307,-2.38942266100829,-2.38762387456592],"lat":[51.3924194417414,51.3858102915361,51.3864287376909,51.3885251283458,51.3911927086803,51.3902075267909,51.3944198451005,51.3947499891262,51.3924194417414]}]],[[{"lng":[-2.36054024266229,-2.36221338170354,-2.36404689156878,-2.37230129813241,-2.3768892418968,-2.37888645546708,-2.37726297502114,-2.37627426930065,-2.36054024266229],"lat":[51.3647242362565,51.3610904418517,51.3552971129561,51.3549186793757,51.3573081274146,51.3600387889077,51.3630589657126,51.3658737358014,51.3647242362565]}]],[[{"lng":[-2.46538464309122,-2.46518537879981,-2.47668382922672,-2.47480438873384,-2.47642536521005,-2.48219864502355,-2.48235943029345,-2.49464699809951,-2.49094520737305,-2.47937157240097,-2.48227177578618,-2.48220512229091,-2.47855688202007,-2.48216582335497,-2.48226473691352,-2.49106761712508,-2.49449662365384,-2.49274619453409,-2.50017635203503,-2.4980905838997,-2.49665202866407,-2.4830551697924,-2.48142773786857,-2.46538464309122],"lat":[51.3367790803065,51.329706943912,51.3275092155734,51.3345426033847,51.3287803329447,51.3264313234087,51.3264846606426,51.3239893453274,51.3217980538149,51.3256149652266,51.3221633814345,51.321839878595,51.3172505279374,51.3178414473848,51.3178267104979,51.3151956863032,51.3170317857187,51.3204075271465,51.3238063285182,51.3270640666626,51.3351629452507,51.3370019140287,51.3371473776635,51.3367790803065]}]],[[{"lng":[-2.48870359232234,-2.48436887538914,-2.49312805540385,-2.49517570700171,-2.49594309916773,-2.49476033989231,-2.49473236497247,-2.49482240328449,-2.49021360806859,-2.48870359232234],"lat":[51.407820963234,51.4029422789771,51.4043116706766,51.4015072580483,51.4013635627723,51.4052278857805,51.4053756851185,51.4095943389508,51.4102772822729,51.407820963234]}]],[[{"lng":[-2.52726001192712,-2.54503255363091,-2.54642196214059,-2.55073038743594,-2.5631084712686,-2.58727140882044,-2.59013240555662,-2.58440350154035,-2.58155267290901,-2.57939305283152,-2.57075411996343,-2.56757054682177,-2.56426977374957,-2.5613733361723,-2.55881125047785,-2.55632947592297,-2.54962406883262,-2.54387736658124,-2.54340658286662,-2.53646473865606,-2.53450157886369,-2.52726001192712],"lat":[51.4118436857957,51.4002619384897,51.3961110849712,51.392542814916,51.4006667202952,51.3951470772971,51.3975451752644,51.4004067706797,51.4007750319573,51.3997574335058,51.3993691909816,51.4033248787809,51.4070784271636,51.410654196901,51.4112337631451,51.40960301559,51.4092637066695,51.4076204945577,51.4074329798158,51.4122274849115,51.4138484097003,51.4118436857957]}]],[[{"lng":[-2.54229205947403,-2.54055038986811,-2.54674912838822,-2.55043063379618,-2.54885696424275,-2.54229205947403],"lat":[51.4171553722033,51.412819954255,51.4141400198175,51.413380136189,51.4178758407097,51.4171553722033]}]],[[{"lng":[-2.34897665251022,-2.35145938591343,-2.35555281761266,-2.35581865622074,-2.35880788024201,-2.3584838775285,-2.35271413606714,-2.35219427320218,-2.34897665251022],"lat":[51.3876216541932,51.3867258581845,51.3891598265176,51.3893795374531,51.3893768080432,51.3906324745186,51.3918159236214,51.3922056139105,51.3876216541932]}]],[[{"lng":[-2.36497732307691,-2.35737843127432,-2.3584838775285,-2.35880788024201,-2.36143180340001,-2.35996710960378,-2.36275762695524,-2.36242642326165,-2.36706573860452,-2.36497732307691],"lat":[51.4010512155735,51.3946782376194,51.3906324745186,51.3893768080432,51.3873433420048,51.392348169724,51.3917559155881,51.3982119957478,51.4019549087996,51.4010512155735]}]],[[{"lng":[-2.46518537879981,-2.46162909758515,-2.47121967496637,-2.47855688202007,-2.48220512229091,-2.48227177578618,-2.47937157240097,-2.49094520737305,-2.49464699809951,-2.48235943029345,-2.48219864502355,-2.47642536521005,-2.47480438873384,-2.47668382922672,-2.46518537879981],"lat":[51.329706943912,51.324897718476,51.3165716066946,51.3172505279374,51.321839878595,51.3221633814345,51.3256149652266,51.3217980538149,51.3239893453274,51.3264846606426,51.3264313234087,51.3287803329447,51.3345426033847,51.3275092155734,51.329706943912]}]],[[{"lng":[-2.36298649976713,-2.3611557897012,-2.36110336421737,-2.36755808240733,-2.36646745955379,-2.36998515510119,-2.36843563205427,-2.36298649976713],"lat":[51.3752517174478,51.3732852797144,51.3718241647733,51.3692587033908,51.3737047274514,51.3743800862947,51.3760837423363,51.3752517174478]}]],[[{"lng":[-2.54123493345367,-2.54992449615474,-2.5529994348937,-2.54400108589948,-2.54372667995083,-2.5232107316042,-2.5313127993692,-2.5292542003466,-2.53376475478248,-2.54123493345367],"lat":[51.4223128855462,51.426561180437,51.4302082945622,51.4306405322945,51.430566099251,51.4261372327564,51.4233079784072,51.4212788045426,51.4182146703664,51.4223128855462]}]],[[{"lng":[-2.3911045589307,-2.39223713782752,-2.39709050413155,-2.39843457738937,-2.40500633026246,-2.4055367372933,-2.41163002867586,-2.40788961046817,-2.40019568759322,-2.39789552429601,-2.3911045589307],"lat":[51.3944198451005,51.3902075267909,51.3911927086803,51.3885251283458,51.3870189157499,51.3875760155161,51.39273677461,51.3957234714967,51.3937609933066,51.3961894562132,51.3944198451005]}]],[[{"lng":[-2.3835956228016,-2.38357228502352,-2.37888645546708,-2.3768892418968,-2.38229604199306,-2.3835956228016],"lat":[51.3571517527237,51.3571676753977,51.3600387889077,51.3573081274146,51.3539813616662,51.3571517527237]}]],[[{"lng":[-2.38229604199306,-2.3768892418968,-2.37230129813241,-2.37410447625415,-2.3824772634542,-2.38229604199306],"lat":[51.3539813616662,51.3573081274146,51.3549186793757,51.3507928424906,51.3515975544749,51.3539813616662]}]],[[{"lng":[-2.37619586559175,-2.37627426930065,-2.37726297502114,-2.38473244513789,-2.38357228502352,-2.3835956228016,-2.38926216733299,-2.39356093627671,-2.39701046421074,-2.38740359390829,-2.3824725582488,-2.37619586559175],"lat":[51.3662528042949,51.3658737358014,51.3630589657126,51.3628088630526,51.3571676753977,51.3571517527237,51.3639262451259,51.3618851031978,51.3641815850247,51.3659842595821,51.3680901655538,51.3662528042949]}]],[[{"lng":[-2.38012508118601,-2.37942971954,-2.37843290031796,-2.37437786346905,-2.38012508118601],"lat":[51.3754159868319,51.3777175936838,51.3789941345469,51.3760404634427,51.3754159868319]}]],[[{"lng":[-2.37888645546708,-2.38357228502352,-2.38473244513789,-2.37726297502114,-2.37888645546708],"lat":[51.3600387889077,51.3571676753977,51.3628088630526,51.3630589657126,51.3600387889077]}]],[[{"lng":[-2.29180207492052,-2.29192601702916,-2.29574286601758,-2.28526350486893,-2.28744328517158,-2.29461574142493,-2.31261575485688,-2.3138442661772,-2.32502125542503,-2.34328971641227,-2.34739397583468,-2.33768306139137,-2.34653160434667,-2.36724308186664,-2.3701952016699,-2.36538682727745,-2.3468534817312,-2.32477665252999,-2.31547894390305,-2.3114230170525,-2.2905579460356,-2.29180207492052],"lat":[51.4729012479302,51.4725095558217,51.4585900899004,51.4579281540787,51.4555687452968,51.4288015723113,51.422446129671,51.4289038106821,51.4369834463781,51.4395335305134,51.4482191359273,51.455573127548,51.4590027719681,51.4578219971301,51.4649700575943,51.4717559780395,51.4739505342344,51.4841204916936,51.4817982554831,51.4873731728576,51.4868576114878,51.4729012479302]}]],[[{"lng":[-2.50407016997052,-2.51031710849499,-2.49758016773504,-2.4989664465457,-2.52037386874331,-2.51648103656327,-2.52425874388482,-2.51579536869014,-2.51470087479957,-2.50407016997052],"lat":[51.3267664605977,51.3241689321246,51.3207439992184,51.3175638964013,51.3196597283023,51.3233175778059,51.3274167688511,51.3304170949572,51.3259592085187,51.3267664605977]}]],[[{"lng":[-2.49449662365384,-2.50767406081476,-2.51353284509373,-2.50991346202177,-2.50806337758472,-2.52800356957133,-2.5467324355802,-2.55416437056239,-2.55280334540121,-2.55782434585227,-2.55724070358521,-2.54863263698019,-2.54057431605985,-2.53766961915003,-2.53406975157679,-2.52850440215095,-2.52193170607225,-2.52037386874331,-2.4989664465457,-2.49758016773504,-2.51031710849499,-2.50407016997052,-2.4980905838997,-2.50017635203503,-2.49274619453409,-2.49449662365384],"lat":[51.3170317857187,51.3133925508457,51.3101220223429,51.3039419482047,51.2915153921001,51.2931608533328,51.2997076080755,51.298686274909,51.3013174291186,51.3026614492786,51.3031389883778,51.3093085857904,51.3123638010971,51.3104600224788,51.3154032726639,51.3151766888957,51.3158283712965,51.3196597283023,51.3175638964013,51.3207439992184,51.3241689321246,51.3267664605977,51.3270640666626,51.3238063285182,51.3204075271465,51.3170317857187]}]],[[{"lng":[-2.54123493345367,-2.54229205947403,-2.54885696424275,-2.55043063379618,-2.55324292631524,-2.55539927303858,-2.55295037454971,-2.54992449615474,-2.54123493345367],"lat":[51.4223128855462,51.4171553722033,51.4178758407097,51.413380136189,51.413912868238,51.4195575091348,51.4257321724041,51.426561180437,51.4223128855462]}]],[[{"lng":[-2.54229205947403,-2.54123493345367,-2.53376475478248,-2.53394511502478,-2.53401678745134,-2.53450157886369,-2.53646473865606,-2.54055038986811,-2.54229205947403],"lat":[51.4171553722033,51.4223128855462,51.4182146703664,51.4181490280127,51.4181102129594,51.4138484097003,51.4122274849115,51.412819954255,51.4171553722033]}]],[[{"lng":[-2.34959766070121,-2.35075078746787,-2.3611557897012,-2.36298649976713,-2.3570500461289,-2.35131446531014,-2.34959766070121],"lat":[51.3795436235579,51.3721464387674,51.3732852797144,51.3752517174478,51.3770522942313,51.3809464328577,51.3795436235579]}]],[[{"lng":[-2.50834556117977,-2.50277974988395,-2.51651602875018,-2.51837536836444,-2.51150338945859,-2.50834556117977],"lat":[51.4090074567345,51.399701128148,51.3988290189916,51.4048741414943,51.4098992728239,51.4090074567345]}]],[[{"lng":[-2.37833637088955,-2.37701065540405,-2.38845614292048,-2.3888165936924,-2.38762387456592,-2.37833637088955],"lat":[51.3892621875266,51.384424018687,51.3816867619939,51.3858102915361,51.3924194417414,51.3892621875266]}]],[[{"lng":[-2.37013196629814,-2.37437786346905,-2.37843290031796,-2.3733024799839,-2.36965544502893,-2.3679044259759,-2.36843563205427,-2.36998515510119,-2.37013196629814],"lat":[51.3743783687667,51.3760404634427,51.3789941345469,51.3834660181565,51.3813650642103,51.37962878015,51.3760837423363,51.3743800862947,51.3743783687667]}]],[[{"lng":[-2.38463793292213,-2.38422279981908,-2.3889004887688,-2.39169478221754,-2.39054055229492,-2.38463793292213],"lat":[51.3800096382291,51.3768756464627,51.3773079308762,51.378964774292,51.3804185762931,51.3800096382291]}]],[[{"lng":[-2.39306403267471,-2.3951312215043,-2.39809347810494,-2.40381921736649,-2.40132889398481,-2.39306403267471],"lat":[51.4052366940601,51.3981332853525,51.3982208127375,51.4058507397228,51.4075918940402,51.4052366940601]}]],[[{"lng":[-2.3733024799839,-2.37843290031796,-2.37942971954,-2.38463793292213,-2.39054055229492,-2.39063773702248,-2.38845614292048,-2.37701065540405,-2.3733024799839],"lat":[51.3834660181565,51.3789941345469,51.3777175936838,51.3800096382291,51.3804185762931,51.3813899443712,51.3816867619939,51.384424018687,51.3834660181565]}]],[[{"lng":[-2.34575184240744,-2.34140150354204,-2.34402077397053,-2.33811904115167,-2.3249928664129,-2.32484804063369,-2.33968540836512,-2.34928198798238,-2.34575184240744],"lat":[51.3969102469093,51.4006104045622,51.4018973865378,51.4036704794083,51.4039315754508,51.4018208349968,51.3938902345442,51.3955388022072,51.3969102469093]}]],[[{"lng":[-2.34575184240744,-2.34928198798238,-2.35001917312889,-2.35131374614642,-2.35702962715452,-2.35737843127432,-2.36497732307691,-2.35835981732233,-2.34575184240744],"lat":[51.3969102469093,51.3955388022072,51.3959643272717,51.3982941405996,51.394852617611,51.3946782376194,51.4010512155735,51.4031688534536,51.3969102469093]}]],[[{"lng":[-2.36706573860452,-2.36242642326165,-2.36275762695524,-2.36833563301706,-2.36924137335763,-2.37669126450364,-2.37662810183607,-2.38222411120838,-2.38062269800466,-2.38722789485941,-2.37852848046989,-2.37092803858727,-2.36748561724236,-2.37292720597905,-2.36706573860452],"lat":[51.4019549087996,51.3982119957478,51.3917559155881,51.3930413401862,51.3901681039012,51.3889581719777,51.3956572928227,51.3949854330289,51.4006676670809,51.4066332472011,51.41113060063,51.4106180760943,51.4082487655816,51.4045260913854,51.4019549087996]}]],[[{"lng":[-2.46398734572784,-2.46908886323509,-2.47085133568229,-2.47932044063196,-2.48312436642127,-2.47884730961223,-2.47781124307213,-2.47485948606863,-2.46554882506865,-2.46716515447587,-2.45933697965711,-2.46398734572784],"lat":[51.4000142039313,51.3913997042934,51.3877535632844,51.3902404936872,51.3968626387416,51.3966572528089,51.4024686723546,51.4071161312822,51.4100235967054,51.405527043823,51.4013098023391,51.4000142039313]}]],[[{"lng":[-2.38717997979726,-2.38839797639181,-2.39004062852045,-2.39618896207876,-2.3914108123296,-2.38905399106062,-2.38717997979726],"lat":[51.3751018665448,51.3700989486271,51.3716861454611,51.3718633896341,51.3755291801434,51.3767750904621,51.3751018665448]}]],[[{"lng":[-2.38839797639181,-2.38771035187389,-2.38740359390829,-2.39701046421074,-2.40217800907956,-2.39919098892054,-2.39722042037272,-2.39122439186906,-2.39004062852045,-2.38839797639181],"lat":[51.3700989486271,51.369110616813,51.3659842595821,51.3641815850247,51.3658929996875,51.3683675659105,51.3702951419457,51.3687859783555,51.3716861454611,51.3700989486271]}]],[[{"lng":[-2.40729086529151,-2.4042019597757,-2.40055081668002,-2.39609515824084,-2.3914108123296,-2.39618896207876,-2.39004062852045,-2.39122439186906,-2.39722042037272,-2.39919098892054,-2.40872612657479,-2.40729086529151],"lat":[51.3734329277027,51.3727573266403,51.3705456856614,51.3734180218243,51.3755291801434,51.3718633896341,51.3716861454611,51.3687859783555,51.3702951419457,51.3683675659105,51.3687513634066,51.3734329277027]}]],[[{"lng":[-2.41439140905158,-2.41465843372508,-2.42084044108043,-2.42382811533433,-2.4189736612745,-2.4250384322742,-2.41566531013987,-2.41193756062677,-2.41439140905158],"lat":[51.311492194708,51.3152608526073,51.3166041058601,51.3178130209583,51.3206918601001,51.3243918905327,51.3250437096852,51.3173047711388,51.311492194708]}]],[[{"lng":[-2.41224218149374,-2.4055367372933,-2.40500633026246,-2.4018234049221,-2.40317083043368,-2.39899826799588,-2.4027966909121,-2.41224218149374],"lat":[51.3786032470829,51.3875760155161,51.3870189157499,51.3843346736951,51.3818329563858,51.3808275840781,51.3785382948481,51.3786032470829]}]],[[{"lng":[-2.35145938591343,-2.35131446531014,-2.3570500461289,-2.36045803513299,-2.35555281761266,-2.35145938591343],"lat":[51.3867258581845,51.3809464328577,51.3770522942313,51.3776136001735,51.3891598265176,51.3867258581845]}]],[[{"lng":[-2.35555281761266,-2.36045803513299,-2.36329269949425,-2.36313161810383,-2.35581865622074,-2.35555281761266],"lat":[51.3891598265176,51.3776136001735,51.3782654210606,51.3836365194997,51.3893795374531,51.3891598265176]}]],[[{"lng":[-2.31179041568252,-2.31438565652748,-2.32484804063369,-2.3249928664129,-2.33811904115167,-2.33930191311322,-2.32646675243988,-2.32623467649984,-2.32150369367072,-2.31179041568252],"lat":[51.4121051408644,51.4070540855547,51.4018208349968,51.4039315754508,51.4036704794083,51.4063467468122,51.4065191161279,51.4115493382214,51.4137678103999,51.4121051408644]}]],[[{"lng":[-2.52611459288384,-2.52428936533357,-2.50859944908497,-2.52279032215916,-2.51579536869014,-2.52425874388482,-2.51648103656327,-2.52037386874331,-2.52193170607225,-2.52850440215095,-2.5297629008731,-2.53858584461343,-2.53839064640779,-2.5486738124149,-2.54754021131713,-2.55663931492274,-2.57242556315533,-2.57300329030565,-2.57349173074836,-2.59605194707388,-2.58476606107977,-2.58784124307308,-2.56361854932119,-2.55890110942103,-2.55344743694504,-2.54956304452839,-2.54953335867406,-2.54296734768435,-2.54705928487775,-2.53259597140507,-2.52611459288384],"lat":[51.3662996634636,51.361535802701,51.3509161536638,51.3446250582054,51.3304170949572,51.3274167688511,51.3233175778059,51.3196597283023,51.3158283712965,51.3151766888957,51.319809087318,51.3248869520937,51.3340609232871,51.3371519872994,51.34318220594,51.3440963064593,51.3482771832241,51.3490863129439,51.3496317342653,51.3668715217594,51.3684923165283,51.3703974615892,51.3780478875366,51.3731653770082,51.3727083263827,51.3635558514821,51.3635137080004,51.3591112835473,51.3561347703337,51.3566374171532,51.3662996634636]}]]],null,"zones",{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":1,"fill":true,"fillColor":"yellow","fillOpacity":0.5,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"color":"white","weight":2,"bringToFront":false}]},{"method":"addCircleMarkers","args":[[51.3837714745753,51.3942322481358,51.336833937151,51.4087926425098,51.4205306337332,51.3760889055747,51.4005124765725,51.4018108822851,51.3801933144201,51.3756538425249,51.3855323163801,51.3763419407918,51.4107357323114,51.4117142245347,51.3729591995839,51.3685721957986,51.3902758677668,51.3739527782343,51.3697614814634,51.3631247732643,51.3598263370188,51.3816218702434,51.4098637609336,51.3971825436906,51.4150607722536,51.3950427636442,51.3814121393509,51.4050721882867,51.3725895584361,51.3697320117129,51.4166020710769,51.3885642548791,51.3866685944641,51.3326252472022,51.3590046062335,51.3632490732751,51.3519713114521,51.3839335064864,51.3923980774223,51.4330645921612,51.4180640313039,51.3771245135454,51.4109063782599,51.3701957248078,51.3765851923229,51.3968752696459,51.4103778614806,51.3474804977727,51.3192475495584,51.3860811844933,51.4132056705815,51.3966938251863,51.3835977231597,51.3175467245226,51.4297129976033,51.3776833381232,51.3924824419502,51.3185176601048,51.3897231490933,51.3605616388283,51.3287384710023,51.4061990561086,51.4032958086207,51.4154253527459,51.3895358073885,51.3940860000673,51.3234537286777,51.3731384866651,51.4255517078308,51.3919867895043,51.3570853571515,51.3536744203531,51.3642381086031,51.3768544811109,51.3608430566174,51.458468933292,51.3228142883962,51.3064108858039,51.4204699691682,51.4167867985209,51.3757385024215,51.4035748809982,51.3868070303616,51.3788359142012,51.3787425365342,51.4031750154959,51.3814057499894,51.3995288390665,51.3989969010723,51.4005344838631,51.3985737016946,51.3735115758012,51.3673050220608,51.3707415475081,51.3198081609147,51.3818263797622,51.3826060022203,51.3829199147548,51.4078617925853,51.3509449563644],[-2.34714778720951,-2.38250867452928,-2.32985338536759,-2.4792077031964,-2.51469202914377,-2.40682740307861,-2.34840612039621,-2.38860732371511,-2.39758807400553,-2.54162888433851,-2.39791291849635,-2.39491921327475,-2.54381908190049,-2.5510355514362,-2.40023588245499,-2.36723229570511,-2.36454693894577,-2.37636020930116,-2.37741013159376,-2.3341653745846,-2.3503005367527,-2.31811307872031,-2.29527324464068,-2.48803864970145,-2.48005357874307,-2.35303018661004,-2.36546437126428,-2.50085682812924,-2.38592363671476,-2.38418943268497,-2.376827418059,-2.30714178484701,-2.36213594982428,-2.54895285853088,-2.35798391868637,-2.35894010812553,-2.48654921470713,-2.4958201188431,-2.34718314323278,-2.50381132680588,-2.5023513953248,-2.36413944600775,-2.49957050940711,-2.34641065897856,-2.38356278659199,-2.45603461982923,-2.45391622970202,-2.42680586488713,-2.43287671933152,-2.37136691916028,-2.50766806081782,-2.39245254971473,-2.39122028472695,-2.55693446087203,-2.44724245403811,-2.3319104854359,-2.35615531248821,-2.37741895939314,-2.39189821768312,-2.36992007556837,-2.48405227486328,-2.49112036348855,-2.55469619016177,-2.54554674990475,-2.3533735369535,-2.36062323498299,-2.47452159618376,-2.36507909243075,-2.53846859699369,-2.40144189716385,-2.38039931424829,-2.37730822725674,-2.3850459747035,-2.37775852214142,-2.38149969833696,-2.31993734565156,-2.51128964823059,-2.52484929636562,-2.54900852413607,-2.53829795949505,-2.35477519841254,-2.51115423820768,-2.38371872764046,-2.37248107950673,-2.38759531128032,-2.3979953671348,-2.38108358370081,-2.33653506394163,-2.3564116592156,-2.37400623511886,-2.47205334763858,-2.3905885252386,-2.39409890436385,-2.40006636596335,-2.41741006025767,-2.40574035588061,-2.35529731755875,-2.36015442430296,-2.32314209141087,-2.54811706361543],1,null,"zone centre points",{"interactive":true,"className":"","stroke":true,"color":"black","weight":2,"opacity":0.5,"fill":true,"fillColor":"black","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[[],["zone","zone centre points"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[51.2915153921001,51.4873731728576],"lng":[-2.59605194707388,-2.27854158250835]}},"evals":[],"jsHooks":[]}</script>

Download Origin Destination (OD) data for zones from LSOA data store.
Generate OD desire lines.

<!-- ```{r dls, echo=FALSE, warning=FALSE} -->
<!-- me_pal <- c("#0000b3", "#0000eb", "#1d00ff", "#4a00ff", "#7600ff", "#a211ee", "#cf2ed1", "#fb4ab5",  -->
<!--             "#ff6798", "#ff837c", "#ff9f60", "#ffbc43", "#ffd827", "#fff50a") -->
<!-- desire_lines_motor <- select(desire_lines, car_driver, motorbike, bus, taxi_other) -->
<!-- vehicle_types <- c("car_driver", "motorbike", "bus", "taxi_other") -->
<!-- max_n <- max(desire_lines$car_driver, desire_lines$motorbike, desire_lines$bus, desire_lines$taxi_other) -->
<!-- pal_v <- colorFactor(me_pal, domain = seq(0,max_n, length.out = 10), reverse = FALSE) -->
<!-- m <- leaflet() %>%  -->
<!--   setView(lon, lat, zoom = 11) %>%  -->
<!--   addProviderTiles('CartoDB.Positron') %>%  -->
<!--   addScaleBar(position = "bottomleft", options = scaleBarOptions(metric = TRUE)) -->
<!-- m <- m %>% addPolygons(data = zones_in, color = 'black', weight = 1, fillColor = "yellow", -->
<!--                        opacity = 1.0, fillOpacity = 0.5, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zones") -->
<!-- for (v in vehicle_types){ -->
<!--   v_df <- desire_lines_motor %>%  -->
<!--     select(vtype = v) %>%  -->
<!--     filter(vtype > 0) -->
<!--   v_df$vtype <- as.numeric(v_df$vtype) -->
<!-- m <- m %>% addPolylines(data = v_df, color = ~pal_v(v_df$vtype), weight = 2, group = v) -->
<!-- } -->
<!-- m <- m %>% addLegend("bottomleft", pal=pal_v, values=seq(0,max_n, length.out = 10), opacity=1, title = "trips") -->
<!-- m <- m %>% addLayersControl(overlayGroups = c("zones"), baseGroups = vehicle_types, -->
<!--                             options = layersControlOptions(collapsed = FALSE), position = "topright") -->
<!-- m -->
<!-- ``` -->
<!-- Using the osrm R package an estimated route is generated for each car unique OD combination and the journeys assigned. The routes are then combined using the overline function from the stplanr R package -->
<!-- ```{r overline, echo = FALSE, warning = FALSE} -->
<!-- max_cars <- max(r$car_driver) -->
<!-- bks_hr <- seq(from = 0, to = max(r$car_driver), by = max_cars/NROW(me_pal)) -->
<!-- # tmaptools::palette_explorer() -->
<!-- tm0 <- tm_shape(r) + -->
<!--   tm_lines(palette = me_pal, breaks = bks_hr, -->
<!--            lwd = "car_driver", -->
<!--            scale = 20, -->
<!--            title.lwd = "Number of vehicles", -->
<!--            alpha = 0.6, -->
<!--            col = "car_driver", -->
<!--            title = "Flow (number of vehicles)" -->
<!--   ) + -->
<!--   tm_layout(frame = FALSE, legend.outside = TRUE)+ -->
<!--   tm_scale_bar(position = c("left", "bottom")) -->
<!-- tm0 -->
<!-- ``` -->
<!-- Assuming people start from the centre of a zone can seem like an insignificant simplification when looking at a large area, however, looking more closely at the possibilities for start and end points within a zone and the effect they can have shows it can make a big difference to the likely route someone will take. -->
<!-- Using zone E01014479, which will be called 'zone A' as an example below, every journey could theoretically start or finish at any point in the zone. However, even if someone starts from the middle of a field they will not be able to begin driving until they reach a road. Similarly it is also quite likely journeys will start and end at buildings. For privacy and data simplification reasons the census data is not available at household level, so knowing where in a zone a journey starts or ends is not possible. -->
<!-- ```{r zones_buildings, echo = FALSE, warning = FALSE} -->
<!-- pal_B <- colorFactor("viridis", domain = buildings_in$building, reverse = FALSE) -->
<!-- lon <- st_coordinates(zone_A_cent)[,1] -->
<!-- lat <- st_coordinates(zone_A_cent)[,2] -->
<!-- m <- leaflet() %>%  -->
<!--   setView(lon, lat, zoom = 15) %>%  -->
<!--   addProviderTiles('CartoDB.Positron') -->
<!-- m <- m %>% addPolygons(data = buildings_in, color = 'black', weight = 1, fillColor = ~pal_B(buildings_in$building), -->
<!--                        opacity = 1.0, fillOpacity = 1, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "buildings") -->
<!-- m <- m %>% addPolygons(data = zone_A, color = 'black', weight = 1, fillColor = "grey", -->
<!--                        opacity = 1.0, fillOpacity = 0.2, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zone") -->
<!-- m <- m %>% addCircleMarkers(data = zone_A_cent, color = "red", weight = 2, group = "zone_centre") -->
<!-- m <- m %>% addPolylines(data = zone_rds_A, color = "purple", weight = 2, group = "roads") -->
<!-- m <- m %>% addLegend("bottomleft", pal=pal_B, values=buildings_in$building, opacity=1, title = "Type", -->
<!--                      group = "Buildings") -->
<!-- m <- m %>% addLayersControl(overlayGroups = c("buildings", "roads", "zone_centre", "zone"), -->
<!--                             options = layersControlOptions(collapsed = FALSE), position = "topright") -->
<!-- m -->
<!-- ``` -->
<!-- Taking zone E01014479 as 'zone A' and E01014482 as 'zone B' as example OD pairs. The possible start and end points, if the road network is split into 5 metre uniform points are shown below. -->
<!-- Generating routes between these different pairs the difference start and finish point makes on a journey is shown below, by selecting 4 different route options. -->
<!-- ```{r variation, echo = FALSE, warning = FALSE} -->
<!-- baf <- osmdata::getbb("Bath", format_out = "sf_polygon") %>%  -->
<!--   st_transform(ukgrid) %>%  -->
<!--   st_buffer(-200) %>%  -->
<!--   st_transform(latlong) -->
<!-- baf_zones <- zones_in[baf,] -->
<!-- approx_interval <- 5 -->
<!-- vz <- unique(zone_rds_B$osm_id) -->
<!-- vgt_split <- list() -->
<!-- for (v in vz){ -->
<!--   tryCatch({ -->
<!--     df <- zone_rds_B %>% filter(osm_id == v) %>% st_transform(ukgrid) %>% mutate(lngths = as.numeric(st_length(geometry))) -->
<!--     n_pts <- df$lngths/approx_interval -->
<!--     df1 <- st_line_sample(df, sample = 0) -->
<!--     df2 <- st_line_sample(df, n = n_pts) -->
<!--     df3 <- st_line_sample(df, sample = 1) -->
<!--     df1 <- data.frame(st_coordinates(df1)) -->
<!--     df2 <- data.frame(st_coordinates(df2)) -->
<!--     df3 <- data.frame(st_coordinates(df3)) -->
<!--     df <- rbind(df1, df2, df3) -->
<!--     df <- transmute(df, Source.name = v, X, Y) -->
<!--     vgt_split[[v]] <- df -->
<!--   }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")}) -->
<!-- } -->
<!-- vgt <- do.call(rbind, vgt_split) -->
<!-- B_pts <- st_as_sf(vgt, coords = c("X", "Y"), crs = ukgrid) -->
<!-- B_pts$ID <- rownames(B_pts) -->
<!-- B_pts$zone <- "zone_B" -->
<!-- vz <- unique(zone_rds_A$osm_id) -->
<!-- vgt_split <- list() -->
<!-- for (v in vz){ -->
<!--   tryCatch({ -->
<!--     df <- zone_rds_A %>% filter(osm_id == v) %>% st_transform(ukgrid) %>% mutate(lngths = as.numeric(st_length(geometry))) -->
<!--     n_pts <- df$lngths/approx_interval -->
<!--     df1 <- st_line_sample(df, sample = 0) -->
<!--     df2 <- st_line_sample(df, n = n_pts) -->
<!--     df3 <- st_line_sample(df, sample = 1) -->
<!--     df1 <- data.frame(st_coordinates(df1)) -->
<!--     df2 <- data.frame(st_coordinates(df2)) -->
<!--     df3 <- data.frame(st_coordinates(df3)) -->
<!--     df <- rbind(df1, df2, df3) -->
<!--     df <- transmute(df, Source.name = v, X, Y) -->
<!--     vgt_split[[v]] <- df -->
<!--   }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")}) -->
<!-- } -->
<!-- vgt <- do.call(rbind, vgt_split) -->
<!-- A_pts <- st_as_sf(vgt, coords = c("X", "Y"), crs = ukgrid) -->
<!-- A_pts$ID <- rownames(A_pts) -->
<!-- A_pts$zone <- "zone_A" -->
<!-- pts <- rbind(A_pts, B_pts) -->
<!-- ## examples of opposite jounneys -->
<!-- route_pairs <- data.frame(start = c("121120357.6", -->
<!--                                     "671912551.2", -->
<!--                                     "671912551.2", -->
<!--                                     "510800084.56"), -->
<!--                           end = c("510800084.56",  -->
<!--                                   "89126716.40",  -->
<!--                                   "121120357.6",  -->
<!--                                   "89126716.40")) -->
<!-- routez <- list() -->
<!-- starts <- list() -->
<!-- ends <- list() -->
<!-- for (r in seq(1:NROW(route_pairs))){ -->
<!--   rp <- route_pairs[r,] -->
<!--   sp <- pts %>% filter(ID == rp$start) %>% st_transform(latlong) -->
<!--   ep <- pts %>% filter(ID == rp$end) %>% st_transform(latlong) -->
<!--   route <- osrmRoute(src = sp, dst = ep, -->
<!--                      overview = "full", returnclass = "sf") -->
<!--   nam <- as.character(r) -->
<!--   routez[[nam]] <- route -->
<!--   starts[[nam]] <- sp -->
<!--   ends[[nam]] <- ep -->
<!-- } -->
<!-- all_routes <- do.call(rbind, routez) -->
<!-- all_starts <- do.call(rbind, starts) -->
<!-- all_ends <- do.call(rbind, ends) -->
<!-- lon <- mean(st_coordinates(baf_zones)[,1]) -->
<!-- lat <- mean(st_coordinates(baf_zones)[,2]) -->
<!-- m <- leaflet() %>%  -->
<!--   setView(lon, lat, zoom = 13) %>%  -->
<!--   addProviderTiles('CartoDB.Positron') -->
<!-- m <- m %>% addPolygons(data = zone_B, color = 'black', weight = 1, fillColor = "grey", -->
<!--                        opacity = 1.0, fillOpacity = 0.2, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zones") -->
<!-- m <- m %>% addPolygons(data = zone_A, color = 'black', weight = 1, fillColor = "grey", -->
<!--                        opacity = 1.0, fillOpacity = 0.2, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zones") -->
<!-- m <- m %>% addPolylines(data = zone_rds_A, color = "yellow", weight = 2, group = "osm road geometry") -->
<!-- m <- m %>% addPolylines(data = zone_rds_B, color = "yellow", weight = 2, group = "osm road geometry") -->
<!-- m <- m %>% addCircleMarkers(data = A_pts, color = "red", fillColor = "red", weight = 2, radius = 2, group = "points") -->
<!-- m <- m %>% addCircleMarkers(data = B_pts, color = "red", fillColor = "red", weight = 2, radius = 2, group = "points") -->
<!-- m <- m %>% addLayersControl(overlayGroups = c("zones", "osm road geometry", "points"), -->
<!--                             options = layersControlOptions(collapsed = FALSE), position = "topright") -->
<!-- m -->
<!-- ``` -->
<!-- ```{r bath, echo = FALSE, warning = FALSE} -->
<!-- LSOA_small <- filter(LSOA_in, geo_code1 %in% c("E01014479", "E01014482") & geo_code2 == c("E01014479", "E01014482")) -->
<!-- zones_small <- filter(zones_in, geo_code == "E01014482" | geo_code == "E01014479") -->
<!-- zones_cent <- st_centroid(zones_small) -->
<!-- route_small <- osrmRoute(src = zones_cent[1,], dst = zones_cent[2,], -->
<!--                    overview = "full", returnclass = "sf") -->
<!-- lon <- st_coordinates(st_centroid(baf[1,]))[1] -->
<!-- lat <- st_coordinates(st_centroid(baf[1,]))[2] -->
<!-- m <- leaflet() %>%  -->
<!--   setView(lon, lat, zoom = 13) %>%  -->
<!--   addProviderTiles('CartoDB.Positron') %>%  -->
<!--   addScaleBar(position = "bottomleft", options = scaleBarOptions(metric = TRUE)) -->
<!-- m <- m %>% addPolygons(data = zones_small, color = 'green', weight = 2, fillColor = "green", -->
<!--                        opacity = 1.0, fillOpacity = 0.3, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zones A/B") -->
<!-- m <- m %>% addPolygons(data = baf_zones, color = 'black', weight = 1, fillColor = "grey", -->
<!--                        opacity = 1.0, fillOpacity = 0.2, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "bath zones") -->
<!-- m <- m %>% addCircleMarkers(data = zones_cent, color = "red", weight = 2, group = "zone_centre") -->
<!-- m <- m %>% addPolylines(data = desire_lines_small, color = "purple", weight = 2, group = "desire line") -->
<!-- m <- m %>% addLayersControl(overlayGroups = c("zones A/B", "bath zones", "zone_centre", "desire line"), -->
<!--                             options = layersControlOptions(collapsed = FALSE), position = "topright") -->
<!-- m -->
<!-- ``` -->
<!-- ```{r start_end, echo = FALSE, warning = FALSE} -->
<!-- m <- leaflet() %>%  -->
<!--   setView(lon, lat, zoom = 14) %>%  -->
<!--   addProviderTiles('CartoDB.Positron') %>%  -->
<!--   addScaleBar(position = "bottomleft", options = scaleBarOptions(metric = TRUE)) -->
<!-- m <- m %>% addPolygons(data = zones_small, color = 'green', weight = 2, fillColor = "green", -->
<!--                        opacity = 1.0, fillOpacity = 0.3, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "zones small") -->
<!-- m <- m %>% addPolygons(data = baf_zones, color = 'black', weight = 1, fillColor = "grey", -->
<!--                        opacity = 1.0, fillOpacity = 0.2, -->
<!--                        highlightOptions = highlightOptions(color = "white", weight = 2, -->
<!--                                                            bringToFront = FALSE), group = "bath zones") -->
<!-- m <- m %>% addCircleMarkers(data = zones_cent, color = "red", weight = 2, group = "route centre") -->
<!-- m <- m %>% addPolylines(data = route_small, color = "purple", weight = 2, group = "route centre") -->
<!-- m <- m %>% addPolylines(data = all_routes[1,], color = "purple", weight = 2, group = "route 1") -->
<!-- m <- m %>% addCircleMarkers(data = all_starts[1,], color = "green", weight = 2, group = "route 1") -->
<!-- m <- m %>% addCircleMarkers(data = all_ends[1,], color = "red", weight = 2, group = "route 1") -->
<!-- m <- m %>% addPolylines(data = all_routes[2,], color = "purple", weight = 2, group = "route 2") -->
<!-- m <- m %>% addCircleMarkers(data = all_starts[2,], color = "green", weight = 2, group = "route 2") -->
<!-- m <- m %>% addCircleMarkers(data = all_ends[2,], color = "red", weight = 2, group = "route 2") -->
<!-- m <- m %>% addPolylines(data = all_routes[3,], color = "purple", weight = 2, group = "route 3") -->
<!-- m <- m %>% addCircleMarkers(data = all_starts[3,], color = "green", weight = 2, group = "route 3") -->
<!-- m <- m %>% addCircleMarkers(data = all_ends[3,], color = "red", weight = 2, group = "route 3") -->
<!-- m <- m %>% addPolylines(data = all_routes[4,], color = "purple", weight = 2, group = "route 4") -->
<!-- m <- m %>% addCircleMarkers(data = all_starts[4,], color = "green", weight = 2, group = "route 4") -->
<!-- m <- m %>% addCircleMarkers(data = all_ends[4,], color = "red", weight = 2, group = "route 4") -->
<!-- m <- m %>% addLayersControl(overlayGroups = c("zones small", "bath zones"), -->
<!--                             baseGroups = c("route 1", "route 2", "route 3", "route 4", "route centre"), -->
<!--                             options = layersControlOptions(collapsed = FALSE), position = "topright") -->
<!-- m -->
<!-- ``` -->
<!-- Using the methodology OD jitter developed by ... the OD start and end points can be randomly varied based on a defined geometry within each zone. In this case the osm road geometry was used as previously described. -->
<!-- [](out/plots/OD_raw.gif) -->
<!-- [](out/plots/OD_jitter.gif) -->
<!-- [](out/plots/OD_jitter_trimmed.gif) -->
<!-- In 2017 two detailed surveys were undertaken in the Bath area. One using pneumatic loops to count vehicles passing and another using ANPR data. -->
<!-- Both these datasets can be used to validate the estimates generated from the OD matrices. -->
<!-- ```{r ol_routes, echo=FALSE, warning=FALSE} -->
<!-- library(stplanr) -->
<!-- site_coords <- st_coordinates(all_sites) -->
<!-- bb <- st_as_sfc(st_bbox(c(xmin = min(site_coords[,1]), xmax = max(site_coords[,1]), ymax = max(site_coords[,2]), ymin = min(site_coords[,2])), crs = st_crs(4326))) -->
<!-- bb_buff <- bb %>%  -->
<!--   st_transform(ukgrid) %>%  -->
<!--   st_buffer(1000) %>%  -->
<!--   st_transform(latlong) -->
<!-- # snap the atcs locations to the roads -->
<!-- rdz_noresi <- rdz[bb_buff,] %>%  -->
<!--   select(osm_id, geometry, highway) %>%  -->
<!--   filter(highway %in% c("tertiary", "primary", "trunk")) %>%  -->
<!--   st_transform(ukgrid) %>%  -->
<!--   st_line_sample(n = 20) %>%  -->
<!--   st_cast("POINT") %>%  -->
<!-- st_transform(latlong) %>%  -->
<!--   st_as_sf() -->
<!-- rdz_resi <- rdz[bb_buff,] %>%  -->
<!--   select(osm_id, geometry, highway) %>%  -->
<!--   filter(highway %in% c("residential")) %>%  -->
<!--   st_transform(ukgrid) %>%  -->
<!--   st_line_sample(n = 20) %>%   -->
<!--   st_cast("POINT") %>%  -->
<!--   st_transform(latlong) %>%  -->
<!--   st_as_sf() -->
<!-- sites_2 <- filter(all_sites, site_ID %in% c("20170104", "20170106")) -->
<!-- sites_7 <- filter(all_sites, !site_ID %in% c("20170104", "20170106")) -->
<!-- atcs1 <- rdz_noresi[st_nearest_feature(sites_7, rdz_noresi),] %>%  -->
<!--   mutate(site_ID = sites_7$site_ID) -->
<!-- atcs2 <- rdz_resi[st_nearest_feature(sites_2, rdz_resi),] %>%  -->
<!--   mutate(site_ID = sites_2$site_ID) -->
<!-- atc_snap <- rbind(atcs1, atcs2) -->
<!-- overline_routes <- list() -->
<!-- overline_trimmed <- list() -->
<!-- atc_vars <- list() -->
<!-- ur <- unique(routes_all$ID) -->
<!-- for (rt in ur){ -->
<!--   dr <- filter(routes_all, ID == rt) -->
<!--   r <- overline(sl = dr, attrib = "car_driver", ncores = 4) %>%  -->
<!--     mutate(ID = rt) -->
<!--   overline_routes[[rt]] <- r -->
<!--   r_trim <- st_intersection(r, bb_buff) -->
<!--   overline_trimmed[[rt]] <- r_trim -->
<!--   atcs <- r_trim[st_nearest_feature(atc_snap, r_trim),] %>%  -->
<!--     mutate(site_ID = str_sub(atc_snap$site_ID, 7,-1)) %>%  -->
<!--     st_set_geometry(NULL) -->
<!--   atc_vars[[rt]] <- atcs -->
<!--   } -->
<!-- ol_routes <- do.call(rbind, overline_routes) -->
<!-- ol_trimmed <- do.call(rbind, overline_trimmed) -->
<!-- all_atcs <- do.call(rbind, atc_vars) -->
<!-- gg_pal <- c("#f7766c", "#d29200", "#92aa00", "#00ba37", "#00c19e",  -->
<!--   "#03b8e3", "#619cff", "#da72fb", "#fe61c2") -->
<!-- tm3 <- tm_shape(ol_trimmed) + -->
<!--   tm_lines(palette = me_pal, breaks = bks_hr, -->
<!--            lwd = "car_driver", -->
<!--            scale = 20, -->
<!--            title.lwd = "Number of vehicles", -->
<!--            alpha = 0.6, -->
<!--            col = "car_driver", -->
<!--            title = "Flow (number of vehicles)" -->
<!--   ) + -->
<!--   tm_facets(along = "ID", free.coords = FALSE)+ -->
<!--   tm_layout(frame = FALSE, legend.outside = TRUE)+   -->
<!--   tm_scale_bar(position = c("left", "bottom"))+ -->
<!--   tm_shape(atc_snap)+ -->
<!--   tm_dots(size = 1, col = "site_ID", palette = gg_pal) -->
<!-- a1 <- tmap_animation(tm3, delay = 100) -->
<!-- library(ggplot2) -->
<!-- library(gganimate) -->
<!-- # Make a ggplot, but add frame=year: one image per year -->
<!-- g1 <- ggplot(all_atcs, aes(x=site_ID, y=car_driver, fill=site_ID)) +  -->
<!--   geom_bar(stat='identity') + -->
<!--   theme_bw()+ -->
<!--   # gganimate specific bits: -->
<!--   transition_states( -->
<!--     ID, -->
<!--     transition_length = 1, -->
<!--     state_length = 1 -->
<!--   ) + -->
<!--   ease_aes('sine-in-out') -->
<!-- # Save at gif: -->
<!-- animate(g1, fps = 4) -->
<!-- ``` -->
<!-- Jittering routes very quickly and comparing the outputs with measured data  -->
<!-- Additionally an ANPR survey was also undertaken. This data can either be used as a static count point  -->
<!-- ```{r jittered, echo = FALSE, warning=FALSE} -->
<!-- # baf_cent <- st_centroid(baf[1,]) -->
<!-- #  -->
<!-- # routes_all$ID <- sprintf("%02d", rep(1:NROW(jitters), each=NROW(od_jittered))) -->
<!-- # jitters_all$ID <- sprintf("%02d", rep(1:NROW(jitters), each=NROW(od_jittered))) -->
<!-- # ur <- unique(routes_all$ID) -->
<!-- ``` -->
